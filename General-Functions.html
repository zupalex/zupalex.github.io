<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="scripts/mystyles.css">
</head>
<body>

<div class="container-master">
<div class="container-full-width">
<header>
   <h1>luaXroot Wiki</h1>
</header>
</div>

<div class="container-content">
<nav>
<iframe src="sidebar.html" style="border:none;"></iframe>
</nav>

<article>



<h2 id="intro"><a href="#sys-calls-and-basic-funcs">System calls and basic functions</a><h2>
<ul>
  <li><a href="#lua-libraries">Lua libraries</a></li>
  <li><a href="#luaxroot-additions"><b>luaXroot</b></a>
  		 <details><summary><span style="font-weight: normal;font-size: 70%">click to expand</span></summary>
    <ul>
    <li><a href="#sysopen">SysOpen</a></li>
    <li><a href="#sysclose">SysClose</a></li>
    <li><a href="#sysftruncate">SysFtruncate</a></li>
    <li><a href="#sysread">SysRead</a></li>
    <li><a href="#syswrite">SysWrite</a></li>
    <li><a href="#sysdup">SysDup</a></li>
    <li><a href="#sysdup2">SysDup2</a></li>
    <li><a href="#makepipe">MakePipe</a></li>
    <li><a href="#makefifo">MakeFifo</a></li>
    <li><a href="#sysftok">SysFtok</a></li>
    <li><a href="#sysselect">SysSelect</a></li>
    <li><a href="#sysexec">SysExec</a></li>
    <li><a href="#sysfork">SysFork</a></li>
    </ul></details></li>
</ul>
  
<h2><a href="#ipc">Inter-Process Communications</a><h2>
<ul>
  <li><a href="#messagesqueues">Message Queues</a>
  	  <details><summary><span style="font-weight: normal;font-size: 70%">click to expand</span></summary>
    <ul>
    <li><a href="#msgget">MsgGet</a></li>
    <li><a href="#msgsnd">MsgSnd</a></li>
    <li><a href="#msgrcv">MsgRcv</a></li>
    <li><a href="#msgclt">MsgCtl</a></li>
    </ul></details></li>
  <li><a href="#semaphores">Semaphores</a>
      <details><summary><span style="font-weight: normal;font-size: 70%">click to expand</span></summary>
    <ul>
    <li><a href=""></a></li>
    </ul></details></li>
  <li><a href="#sharedmemorysegments">Shared Memory Segments</a>
  	  <details><summary><span style="font-weight: normal;font-size: 70%">click to expand</span></summary>
    <ul>
    <li><a href=""></a></li>
    </ul></details></li>
  <li><a href="#memorymappedfiles">Memory Mapped Files</a>
      <details><summary><span style="font-weight: normal;font-size: 70%">click to expand</span></summary>
    <ul>
    <li><a href=""></a></li>
    </ul></details></li>
  <li><a href="#sockets">Sockets</a>
      <details><summary><span style="font-weight: normal;font-size: 70%">click to expand</span></summary>
    <ul>
    <li><a href=""></a></li>
    </ul></details></li>
</ul>

<h2 id="sys-calls-and-basic-funcs">System calls and basic functions</h2>
<h3 id="lua-libraries">Lua libraries</h3>
<p>Lua includes an interface to call some system functions. The <a href="https://www.lua.org/manual/5.3/manual.html#6.9"><i>os</i> library</a>.</p>

<p>A useful function is for instance the <i>getenv</i> function allowing you to retrieve environment variables from a Lua script</p>

<pre class="prettyprint">
   os.getenv("ROOTSYS") -- will return the path the the ROOT installation
</pre>

<p>Lua also includes:
<ul>
<li>a <a href="https://www.lua.org/manual/5.3/manual.html#6.7"><i>math</i></a> library with common and useful mathematical functions.
<li>a <a href="https://www.lua.org/manual/5.3/manual.html#6.8"><i>io</i></a> library to perform classic input/output operations (opening a file, closing a file, reading from a file, writing...)
<li>a <a href="https://www.lua.org/manual/5.3/manual.html#6.4"><i>string</i></a> library It of course has functions to format a string as the 
C function <a href="http://www.cplusplus.com/reference/cstdio/printf/"><i>printf</i></a> would do with <i>string.format</i> or function to search for patterns or extract substrings...
</ul>

<p>The <i>string</i> library has surprising additional functionalities. It can be used to encode and decode binary data using the "<i>string.pack</i>" and "<i>string.unpack</i>" 
functions (<a href="#">more about this here</a>).

<p><a href="#intro">go back to top</a></p>

<h2 id="luaxroot-additions"><b>luaXroot</b> additions</h2>

<p><b>luaXroot</b> also offers binders to most of these system calls and basic functions.<br/>
Below are a list of these functions with a description and their arguments list.</p>

<ul>
<li>Each argument is specified using the following nomenclature: < type, default value if any ><br/>
<b>Examples:</b>  <integer >, < float, 3.14157 >, < string, "O_RDONLY | O_NONBLOCK" >, ...<br/></li>
<li>A <i>[o]</i> in front of an argument means that it's optional.<br/></li>
<li>Some functions takes an arguments table. In this case the arguments are enclosed with <i>{ ... }</i>. Each argument inside the table has a name that <b>MUST</b> be specified when 
calling the function. The advantage of arguments tables is that optional arguments can be omitted completely when calling the function, and passed in any order.</p></li>
</ul>

<h3 id="sysopen"><i>SysOpen</i></h3>
<p>({<b>name</b>=< string >, <i>[o]</i> <b>flags</b>=< string, "O_RDONLY | O_NONBLOCK" >, <i>[p]</i> <b>mode</b>=< string, "0666" >})<br/>
<i>Return values</i>: <b>int</b></p>

<p>Returns an integer corresponding to the [file descriptor](https://en.wikipedia.org/wiki/File_descriptor) associated to the opened file.<br/>
Takes an arguments table.<br/>
You might want to use this function instead of the <i>io.open</i> if you want more controls over how the file is opened (permissions, ...)</p>

<ul>
<li><i>name</i>: the name of the file</li>
<li><i>flags</i>: define how the file will be opened ("O_RDONLY" for read only, "O_RDWR" for read and write, ...). They have to be given as a string. Bitwise AND and OR operations 
are possible (e.g. "O_RDONLY | O_NONBLOCK"). See [this page](https://linux.die.net/man/3/open) for the different flags.</li>
<li><i>mode</i>: permission on the file given as a string (default "0666")</li>
</ul>

<p><a href="#intro">go back to top</a></p>

<h3 id="sysclose"><i>SysClose</i></h3>
<p>(< int >)<br/>
<i>Return values</i>: <b>nil</b></p>

Closes the file associated to the file descriptor passed as the first argument.

<p><a href="#intro">go back to top</a></p>

<h3 id="sysftruncate"><i>SysFtruncate</i></h3>
({<b>fd</b>=< int >, <b>size</b>=< int >})  
<i>Return values</i>: <b>nil</b>

<p>Causes the file associated to the file descriptor <i>fd</i> to be truncated to exactly the size specified by <i>size</i>.<br/>  
It If the file previously was larger than this size, the extra data is lost. If the file previously was shorter, it is extended, and the extended part reads as null bytes ('\0').<br/>
The file offset is not changed.<br/>
<a href="https://linux.die.net/man/2/ftruncate">more information</a></p>

<p><a href="#intro">go back to top</a></p>

<h3 id="sysread"><i>SysRead</i></h3>
<p>({<b>fd</b>=< int >, <i>[o]</i> <b>size</b>=< int >})<br/>
<i>Return value</i>*: <b>string</b>, <b>int</b></p>

<p>Read <i>size</i> bytes from the file corresponding to the file descriptor <i>fd</i>. If <i>size</i> is not specified, read all the available data.<br/>
It returns the read data as a string, followed by the amount of bytes read.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="syswrite"><i>SysWrite</i></h3>
<p>({<b>fd</b>=< int >, <b>data</b>=< string >, <i>[o]</i> <b>size</b>=< int >})<br/>
<i>Return values</i>: <b>int</b></p>

<p>Write <i>size</i> bytes from the string <i>data</i> to the file associated to the file descriptor <i>fd</i>. If <i>size</i> is not specified, it writes all the available data.<br/>
It returns the amount of bytes written.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="sysdup"><i>SysDup</i></h3>
<p>(< int >)<br/>
<i>Return values</i>: <b>int</b></p>

<p>Creates a copy of the file descriptor given as the first argument using the lowest-numbered unused file descriptor.<br/>
It returns that new file descriptor.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="sysdup2"><i>SysDup2</i></h3>
<p>(< int >, < int >)<br/>
<i>Return values</i>: <b>nil</b></p>

<p>Performs the same operation as <a href="#sysdup"><i>SysDup</i></a> but using the file descriptor provided as second argument instead of the lowest-numbered unused one.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="makepipe"><i>MakePipe</i></h3>
<p>( )<br/>
<i>Return values</i>: <b>int</b>, <b>int</b></p>

<p>Creates a pipe between 2 file descriptors and returns them (the first one is the input of the pipe, the second one is the ouput).</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="makefifo"><i>MakeFifo</i></h3>
<p>({<b>name</b>=< string >, <i>[o]</i> <b>mode</b>=< string, "0777" >})  
<i>Return values</i>: <b>nil</b></p>

<p>Create a FiFo using the <i>name</i> argument.<br/>
<i>mode</i> is the permission to use to create the FiFo.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="sysftok"><i>SysFtok</i></h3>
<p>({<b>pathname</b>=< string >, <i>[o]</i> <b>id</b>=< int, 90 >})  <br/>
<i>Return values</i>: <b>int</b></p>

<p>Generates a key using the <i>pathname</i> argument. This key is used to initiate <a href="#semaphores">Semaphores</a>, 
<a href="#messagesqueues">Messages Queues</a> or <a href="#sharedmemorysegments">Shared Memory Segments</a>.<br/>
<i>id</i> is used only if more than 1 key need to be generated using the same file.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id = "sysselect"><i>SysSelect</i></h3>
<p>({<i>[o]</i> <b>read</b>=< table >, <i>[o]</i> <b>write</b>=< table >, <i>[o]</i> <b>exception</b>=< table >})<br/>
<i>Return values</i>: <b>table</b>, <b>table</b>, <b>table</b></p>

<p>Allows to monitor multiple file descriptors simultaneously, and check whether any of these is <i>ready</i> for one of the following operations: read, write and exceptions.<br/>
The file descriptors you wish to monitor should be placed in tables and passed in the matching category.<br/>
When <i>SysSelect</i> returns, it returns 3 <b>tables</b>/<b>nil</b> values. The first value is either <b>nil</b> (if no file descriptor was ready to be read or if none were being monitored for 
read operation) or a table containing all the file descriptors ready to be read. The second value return is the same for the write operation and the third is for the exception operation.<br/>
For a detailed description of the <i>select</i> C function, <a href="http://man7.org/linux/man-pages/man2/select.2.html">click here</a>.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="sysexec"><i>SysExec</i></h3>
<p>({<b>file</b>=< string >, <b>args</b>=< table >, <i>[o]</i> <b>env</b>=< table >})<br/>
<i>Return values</i>: <b>nil</b></p>

Execute the process corresponding to the command <i>file</i> with the arguments <i>args</i>. The first argument in the <i>args</i> table must be the command to execute. 
It is often redundant with the <i>file</i>.<br/>
A list of environment variables can be passed in <i>env</i>.<br/>
For instance, one could run the <i>echo</i> command inside a Lua script<br/>

<pre class=prettyprint>
   SysExec({file="echo", args={"echo", "Hellow World"}}) 
   -- this will display on screen "Hello World" 
   -- and terminate the process
</pre>

<p><a href="#intro">go back to top</a></p>

<h3 id="sysfork"><i>SysFork</i></h3>
<p>({<b>fn</b>=< function >, <i>[o]</i> <b>args</b>=< table >, <i>[o]</i> <b>preinit</b>=< function >})<br/>
<i>Return values</i>: <b>nil</b></p>

<a href="http://man7.org/linux/man-pages/man2/fork.2.html">Fork</a> the process and execute the function <i>fn</i> with the arguments <i>args</i> in the child process.<br/>
This can be used to start a new task in the background. Note that this function duplicates the process and does not create a new thread. It's usage is very 
specific and does not allow further communication with the forked process from the master process. <a href="#startnewtask">StartNewTask</a> should be the preferred method when one wants 
to start a new background task.</p>

<p>Example</p>

<pre class="prettyprint">
   local EchoFn = function(message)
      SysExec({file="echo", args={"echo", message}})
   end

   SysFork({fn=EchoFn, args={"Hello World"}})
   -- This command created a clone of the current process. 
   -- The cloned process will execute the command *echo "Hello World"* 
   -- and terminate while the master process whill keep on running.
</pre>

<p><a href="#intro">go back to top</a></p>

<h2 id="ipc">Inter-Process Communications</h2>

<p><b>luaXroot</b> offer binders for the different inter-process communication tools</p>

<h3 id="messagesqueues">Messages Queues</h3>
<b>luaXroot</b> provides "raw" bindings for the Messages Queues functions as well as wrapper and helper functions.<br/>
The "raw" binders are presented first: <a href="#msgget"><i>MsgGet</i></a>, <a href="#msgsnd"><i>MsgSnd</i></a>, 
<a href="#msgsnd"><i>MsgRcv</i></a>, <a href="#msgctl"><i>MsgCtl</i></a>.

<h3 id="msgget"><i>MsgGet</i></h3>
<p>({<b>key</b>=< int >, <i>[o]</i> <b>flags</b>=< string, "IPC_CREAT | IPC_EXCL | 0666" >})<br/>
<i>Return values</i>: <b>int</b></p>

<p>Create or retrieve a message queue using the key provided by the argument <i>key</i> and returns its ID. 
The fact that the message queue is created or not depends on the <i>flags</i> specified. 
See this link for a <a href="http://pubs.opengroup.org/onlinepubs/7908799/xsh/sysipc.h.html">list of the possible flags</a>.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="msgsnd"><i>MsgSnd</i></h3>
<p>({<b>msgid</b>=< int >, <b>data</b>=< table >, <i>[o]</i> <b>mtype</b>=< int, 0 >, <i>[o]</i> <b>flags</b>=< string >})<br/>
<i>Return values</i>: <b>nil</b></p>

<p>Send the message contained in the table *data* to the message queue identified by <i>msgid</i>.<br/>
The <i>data</i> argument is a table containing itself 2 subtables:</p>
<ul>
<li><i>data</i>={<b>format</b>=< table >, <b>values</b>=< table >}</li>
<li><i>format</i> is the string identifier of the elements inside the message.</li>
<li><i>values</i> are the values of the elements inside the message.</li>
</ul>

<p>Example</p>

<pre class="prettyprint">
   -- [... Some code before generating a key msgkey ... ]

   mid = MsgGet({key=msgkey})

   local message_vals = { 3.14157, "Hello World", true, -8 }
   local message_format = { "float", "string", "bool", "int" }

   local message = { format=message_format , values=message_vals }

   MsgSnd( { msgid=mid, data=message } )
</pre>

<p>For an explanation about <i>mtype</i> and <i>flags</i> (optionnal arguments) see <a href="http://man7.org/linux/man-pages/man2/msgop.2.html">this link</a>.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="msgrcv"><i>MsgRcv</i></h3>
<p>({<b>msgid</b>=< int >, <b>format</b>=< table >, <i>[o]</i> <b>mtype</b>=< int, 0 >, <i>[o]</i> <b>flags</b>=< string >})<br/>
<i>Return values</i>: <b>table</b>, <b>bool</b></p>

<p>Receive the message in the message queue identified by <i>msgid</i>. It uses the <i>format</i> table to determine how to read the message, similarly 
to the <a href="#msgsnd">MsgSnd</a> function.</p>

<p>For an explanation about <i>mtype</i> and <i>flags</i> (optionnal arguments) see <a href="http://man7.org/linux/man-pages/man2/msgop.2.html">this link</a>.</p>

<p><a href="#intro">go back to top</a></p>

<h3 id="msgctl"><i>MsgCtl</i></h3>
<p>({<b>msgid</b>=< int >, <b>cmd</b>=< int >})<br/>  
<i>Return values</i>: <b>nil</b> OR <b>table</b> (depending on <i>cmd</i> argument)</p>

<p>Perform the operation identified by <i>cmd</i> on the message queue identified by <i>msgid</i>.<br/>
The supported operations are:</p>
<ul><li>IPC_STAT: get statistics about the message queue</li>
<li>IPC_RMID: mark the message queue for deletion</li></ul>

<p>These operations are described <a href="http://man7.org/linux/man-pages/man2/msgctl.2.html">here</a>.</p>

<p><a href="#intro">go back to top</a></p>

<h2 id="helpers-and-wrappers">Helpers and Wrappers</h2>
<p>Most of these functions are registered in the <b>global</b> table <i>mgsq</i></p>

<h3 id="printmessagesqueueshelp"><i>PrintMessagesQueuesHelp</i></h3>
<p>( )<br/>
<i>Return values</i>: <b>nil</b></p>

<p>Display help on creating or getting a message queue.</p>

<h3 id="msgq-listactivemsgqs"><i>msgq.ListActiveMsgqs</i></h3>
<p>( )<br/>
<i>Return values</i>: <b>nil</b></p>

<p>Print a list of the active messages queues and provide statistics.</p>

<h3 id="msgqobject"><i>MsgqObject</i></h3>
<p>A Lua Class used to manipulate more easily messages queues.</p>

<h4 ="msgqobject-members">Members</h4>
<ul>
<li><i>path</i>: path to the message queue file (if any).</li>
<li><i>fd</i>: file descriptor of the message queue file (if any).</li>
<li><i>key</i>: key used to open the message queue.</li>
<li><i>id</i>: identifier of the message queue.</li>
<li><i>size</i>: size in bytes of the messages sent and received.</li>
<li><i>owner</i>: whether or not the MsgqObject is the owner of the message queue.</li>
</ul>

<h4 ="msgqobject-methods">Methods</h4>
<ul>
    <li><i>Receive</i>(< table >, < int >, < string >) : Receive a message
         <ul>
		 	 <li>argument 1 as the <a href="#msgsnd"><i>format</i> table</a></li>
			 <li>argument 2 as <i>mtype</i></li>
			 <li>argument 3 as <i>flags</i></li>
		 </ul>
	</li>
</ul>

<h3 id="msgq-createmsgq"><i>msgq.CreateMsgq</i></h3>
<p>( )<br/>
<i>Return values</i>: <b>MsgqObject</b></p>

<h2 id="semaphores">Semaphores</h2>

<p><a href="#intro">go back to top</a></p>

<h2 id="sharedmemorysegments">Shared Memory Segments</h2>

<p><a href="#intro">go back to top</a></p>

<h2 id="memorymappedfiles">Memory Mapped Files</h2>

<p><a href="#intro">go back to top</a></p>

<h2 id="sockets">Sockets</h2>

<p><a href="#intro">go back to top</a></p>










</article>
</div>

<div class="container-full-width">
<footer>https://github.com/zupalex/luaXroot</footer>
</div>
</div>

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
</body>
</html>